# 计时器

```cpp
#ifndef TIMER
#define TIMER

#include <iostream>
#include <chrono>
#include <thread>

class Timer {
public:
    Timer() : start_time(std::chrono::high_resolution_clock::now()), paused(false) {}

    void start() {
        start_time = std::chrono::high_resolution_clock::now();
        paused = false;
    }

    void pause() {
        if (!paused) {
            pause_time = std::chrono::high_resolution_clock::now();
            paused = true;
        }
    }

    void resume() {
        if (paused) {
            auto now = std::chrono::high_resolution_clock::now();
            start_time += now - pause_time;
            paused = false;
        }
    }

    double elapsed() const {
        auto end_time = paused ? pause_time : std::chrono::high_resolution_clock::now();
        return std::chrono::duration<double>(end_time - start_time).count();
    }

    void reset() {
        start_time = std::chrono::high_resolution_clock::now();
        pause_time = std::chrono::time_point<std::chrono::high_resolution_clock>();
        paused = false;
    }

private:
    std::chrono::time_point<std::chrono::high_resolution_clock> start_time;
    std::chrono::time_point<std::chrono::high_resolution_clock> pause_time;
    bool paused;
};

void spinWait(double nanoseconds) {
    auto start = std::chrono::high_resolution_clock::now();
    auto target = start + std::chrono::nanoseconds(static_cast<long long>(nanoseconds));

    while (std::chrono::high_resolution_clock::now() < target) {
        // 自旋等待
    }
}

#endif
```

### 简介

`Timer` 类旨在测量经过时间，并具有开始、暂停、恢复和重置计时器的功能。它使用C++标准库中的 `<chrono>` 库进行高分辨率计时。

### 类定义

```cpp
class Timer {
public:
    Timer();
    void start();
    void pause();
    void resume();
    double elapsed() const;
    void reset();

private:
    std::chrono::time_point<std::chrono::high_resolution_clock> start_time;
    std::chrono::time_point<std::chrono::high_resolution_clock> pause_time;
    bool paused;
};
```

### 方法

1. **构造函数**
    - `Timer()`: 初始化计时器，并将开始时间设置为当前时间。还将 `paused` 标志初始化为 `false`。
2. **开始计时**
    - `void start()`: 通过将开始时间设置为当前时间并取消暂停计时器，开始或重新开始计时。
3. **暂停计时**
    - `void pause()`: 通过将当前时间记录为暂停时间并将 `paused` 标志设置为 `true`，暂停计时器。
4. **恢复计时**
    - `void resume()`: 通过用暂停期间的时间调整开始时间并取消暂停计时器，从暂停状态恢复计时器。
5. **获取经过时间**
    - `double elapsed() const`: 返回总经过时间（以秒为单位）。如果计时器暂停，则计算到暂停时间的经过时间。
6. **重置计时器**
    - `void reset()`: 通过将开始时间设置为当前时间、清除暂停时间并取消暂停计时器，重置计时器。

### 示例用法

```cpp
#include "Timer.h"
#include <iostream>
#include <thread>
int main() {
    Timer t;
    t.start();
    std::this_thread::sleep_for(std::chrono::seconds(2)); // 模拟一些工作
    t.pause();
    
    std::cout << "经过时间: " << t.elapsed() << " 秒\n";

    std::this_thread::sleep_for(std::chrono::seconds(1)); // 模拟暂停

    t.resume();
    std::this_thread::sleep_for(std::chrono::seconds(1)); // 模拟更多的工作

    std::cout << "经过时间: " << t.elapsed() << " 秒\n";

    t.reset();
    std::cout << "计时器重置。经过时间: " << t.elapsed() << " 秒\n";

    return 0;
}
```

### 自旋等待函数

此外，提供了 `spinWait` 函数，以在指定的纳秒时间内进行忙等待。

```cpp
void spinWait(double nanoseconds) {
    auto start = std::chrono::high_resolution_clock::now();
    auto target = start + std::chrono::nanoseconds(static_cast<long long>(nanoseconds));

    while (std::chrono::high_resolution_clock::now() < target) {
        // 忙等待循环
    }
}
```